#!/bin/bash

# -----------------------------------------------------------------------------
# usage 함수: 인자가 부족할 때 안내 메시지 출력 후 종료
# -----------------------------------------------------------------------------
usage() {
    echo "사용법: $0 <nvme-number>"
    echo "예시: $0 7   # -> /dev/nvme7n1p1 을 사용"
    exit 1
}

# -----------------------------------------------------------------------------
# 1) 인자로 넘겨받은 숫자가 없으면 usage 출력
# -----------------------------------------------------------------------------
if [ -z "$1" ]; then
    usage
fi

DEVNUM="$1"

# -----------------------------------------------------------------------------
# 2) 모듈 로드 등 기존 명령어들
# -----------------------------------------------------------------------------
sudo modprobe lz4hc_compress
sudo modprobe lz4_compress
sudo insmod module_f3fs/f3fs.ko

echo 0 | sudo tee /proc/sys/kernel/randomize_va_space

# -----------------------------------------------------------------------------
# 3) /dev/nvme<DEVNUM>n1p1 형태로 마운트
# -----------------------------------------------------------------------------
sudo mount -t f3fs /dev/nvme${DEVNUM}n1p1 /mnt/test
#sudo mount -t f3fs /dev/md${DEVNUM} /mnt/test
#sudo mount -t f3fs /dev/nvme${DEVNUM}n1 /mnt/test
if [ $? -ne 0 ]; then
    echo "ERROR: /dev/nvme${DEVNUM}n1p1 마운트에 실패했습니다."
    exit 1
fi

# -----------------------------------------------------------------------------
# 4) 마운트 후 권한 변경
# -----------------------------------------------------------------------------
sudo chown syslab:syslab /mnt/test

echo "/dev/nvme${DEVNUM}n1p1 이 /mnt/test 에 성공적으로 마운트되었습니다."

